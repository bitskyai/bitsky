(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{AmQH:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetTasks=n,t.refreshTasks=l,t.refreshTasksSuccess=r,t.refreshTasksFail=i;var s=a("wsQp");function n(){return{type:s.RESET_TASKS}}function l(){return{type:s.REFRESH_TASKS}}function r(e){return{type:s.REFRESH_TASKS_SUCCESS,total:e.total,tasks:e.tasks,nextCursor:e.nextCursor,previousCursor:e.previousCursor}}function i(e){return{type:s.REFRESH_TASKS_FAIL,error:e}}},Xktj:function(e,t,a){"use strict";var s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(a("wMY7")),l=s(a("q1tI")),r=function(){return l.default.createElement(n.default,null)};t.default=r},"ml+r":function(e,t,a){"use strict";var s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=r,a("cWXX");var n=s(a("/ezw")),l=s(a("q1tI"));function r(){return l.default.createElement("div",{style:{padding:"0 24px"}},l.default.createElement(n.default,{title:!1,active:!0,paragraph:{width:"100%",rows:6}}))}},wMY7:function(e,t,a){"use strict";var s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Tasks=void 0,a("g9YV");var n=s(a("wCAj"));a("14J3");var l=s(a("BMrR"));a("qVdP");var r=s(a("jsC+"));a("jCWc");var i=s(a("kPKH"));a("Pwec");var o=s(a("CtXQ"));a("lUTK");var u=s(a("BvKs"));a("R9oj");var d=s(a("ECub")),c=s(a("p0pE"));a("miYZ");var f=s(a("tsqr")),m=s(a("d6i3")),p=s(a("1l/V"));a("sRBo");var h=s(a("kaz8"));a("+L6B");var g=s(a("2/Rp"));a("5NDa");var v=s(a("5rEg")),k=s(a("2Taf")),E=s(a("vZ4D")),S=s(a("MhPg")),T=s(a("l4Ni")),y=s(a("ujKo"));a("T2oS");var w=s(a("W9HT")),b=s(a("fFZ8")),R=a("Y2fQ"),C=a("Hx5s"),M=s(a("EVdn")),A=s(a("s/Ur")),F=s(a("q1tI")),D=s(a("LlRK")),x=s(a("LvDl")),H=a("MuoO"),I=s(a("Wgwc")),K=s(a("vOnD")),P=s(a("ml+r")),_=a("AmQH"),B=a("MOfv"),N=s(a("IE/S")),L=a("ydnR"),O=s(a("js9m"));function j(e){var t=z();return function(){var a,s=(0,y.default)(e);if(t){var n=(0,y.default)(this).constructor;a=Reflect.construct(s,arguments,n)}else a=s.apply(this,arguments);return(0,T.default)(this,a)}}function z(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function U(){var e=(0,b.default)(["\n  padding: 100px 0;\n"]);return U=function(){return e},e}var V=K.default.div(U()),Y=F.default.createElement("div",{style:{textAlign:"center",paddingTop:10,paddingBottom:10}},F.default.createElement(w.default,null)),W=function(e){(0,S.default)(a,e);var t=j(a);function a(e){var s;return(0,k.default)(this,a),s=t.call(this,e),s.search=function(){s.setState({selectedRowKeys:[],selectedRows:[]}),s.props.dispatch((0,_.resetTasks)()),s.loadMoreTasks(null)},s.getColumnSearchProps=function(e){return{filterDropdown:function(t){var a=t.setSelectedKeys,n=t.selectedKeys,l=t.confirm,r=t.clearFilters;return F.default.createElement("div",{style:{padding:8}},F.default.createElement(v.default,{ref:function(e){s.searchInput=e},placeholder:"Search ".concat(e),value:n[0],onChange:function(e){return a(e.target.value?[e.target.value]:[])},onPressEnter:function(){return s.handleSearch(n,l,e)},style:{width:250,marginBottom:8,display:"block"}}),F.default.createElement(g.default,{type:"primary",onClick:function(){return s.handleSearch(n&&n[0],l,e)},size:"small",style:{width:90,marginRight:8}},F.default.createElement(R.FormattedMessage,{id:"app.common.messages.search"})),F.default.createElement(g.default,{onClick:function(){return s.handleReset(r,e)},size:"small",style:{width:90}},F.default.createElement(R.FormattedMessage,{id:"app.common.messages.reset"})))},onFilterDropdownVisibleChange:function(e){e&&setTimeout(function(){return s.searchInput.select()})}}},s.getColumnCheckboxProps=function(e,t){return{filterDropdown:function(a){var n=a.setSelectedKeys,l=a.selectedKeys,r=a.confirm,i=a.clearFilters;return F.default.createElement("div",{style:{padding:8},className:"tasks-checkboxgroup"},F.default.createElement(h.default.Group,{options:t,defaultValue:l,onChange:function(t){s.filterConditions[e]=t,n(t)}}),F.default.createElement("div",null,F.default.createElement(g.default,{type:"primary",onClick:function(){return s.handleSearch(l,r,e)},size:"small",style:{width:90,marginRight:8}},F.default.createElement(R.FormattedMessage,{id:"app.common.messages.search"})),F.default.createElement(g.default,{onClick:function(){return s.handleReset(i,e)},size:"small",style:{width:90}},F.default.createElement(R.FormattedMessage,{id:"app.common.messages.reset"}))))}}},s.handleSearch=function(e,t,a){t(),s.setState({searchText:e}),s.filterConditions[a]=e,s.search()},s.handleReset=function(e,t){e(),s.setState({searchText:""}),delete s.filterConditions[t],s.search()},s.props.dispatch((0,_.resetTasks)()),s.state={selectedRowKeys:[],selectedRows:[],loadingMore:!1,loadingTasksData:!0,contentHeight:window.innerHeight,drawerVisiable:!1,selectedTask:void 0,operationBtns:{pausing:!1,resuming:!1,deleting:!1}},s.filterConditions={},s.lastScrollHeight=0,s.resizeTimeoutHandler=void 0,(0,M.default)(window).unbind("resize"),(0,M.default)(window).bind("resize",function(){clearTimeout(s.resizeTimeoutHandler),s.resizeTimeoutHandler=setTimeout(function(){s.setState({contentHeight:window.innerHeight})},500)}),s}return(0,E.default)(a,[{key:"componentDidMount",value:function(){this.initTasksData()}},{key:"componentDidUpdate",value:function(){var e=this;(0,M.default)(".task-table-container .ant-table-body").unbind("scroll"),(0,M.default)(".task-table-container .ant-table-body").bind("scroll",function(){var t=(0,M.default)(".task-table-container .ant-table-body").scrollTop(),a=(0,M.default)(".task-table-container .ant-table-body").outerHeight(),s=document.querySelector(".task-table-container .ant-table-body"),n=s.scrollHeight;n-t-a<200&&e.props.tasks.nextCursor&&(e.state.loadingMore||(e.lastScrollHeight=n,e.loadMoreTasks()))})}},{key:"componentWillUnmount",value:function(){(0,M.default)(window).unbind("resize")}},{key:"onShowDrawer",value:function(e){this.setState({drawerVisiable:!0,selectedTask:e})}},{key:"onCloseDrawer",value:function(){this.setState({drawerVisiable:!1,selectedTask:void 0})}},{key:"onPauseAll",value:function(){var e=(0,p.default)(m.default.mark(function e(){var t;return m.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.state.selectedRows&&this.state.selectedRows.length&&(t=this.state.selectedRows.map(function(e){return e.globalId})),this.setState({operationBtns:{pausing:!0,deleting:!1,resuming:!1}}),e.next=5,(0,B.pauseTasksForManagementAPI)(this.filterConditions.url,t,this.filterConditions.state);case 5:this.setState({operationBtns:{pausing:!1,deleting:!1,resuming:!1}}),this.initTasksData(),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),this.setState({operationBtns:{pausing:!1,deleting:!1,resuming:!1}});case 12:case"end":return e.stop()}},e,this,[[0,9]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"onResumeAll",value:function(){var e=(0,p.default)(m.default.mark(function e(){var t;return m.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.state.selectedRows&&this.state.selectedRows.length&&(t=this.state.selectedRows.map(function(e){return e.globalId})),this.setState({operationBtns:{pausing:!1,deleting:!1,resuming:!0}}),e.next=5,(0,B.resumeTasksForManagementAPI)(this.filterConditions.url,t,this.filterConditions.state);case 5:this.setState({operationBtns:{pausing:!1,deleting:!1,resuming:!1}}),this.initTasksData(),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),this.setState({operationBtns:{pausing:!1,deleting:!1,resuming:!1}});case 12:case"end":return e.stop()}},e,this,[[0,9]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"onDeleteAll",value:function(){var e=(0,p.default)(m.default.mark(function e(){var t;return m.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.state.selectedRows&&this.state.selectedRows.length&&(t=this.state.selectedRows.map(function(e){return e.globalId})),this.setState({operationBtns:{pausing:!1,deleting:!0,resuming:!1}}),e.next=5,(0,B.deleteTasksOrHistoryForManagementAPI)(this.filterConditions.url,t,this.filterConditions.state);case 5:f.default.success((0,R.formatMessage)({id:"app.containers.Tasks.deleteAllSuccessful"})),this.setState({operationBtns:{pausing:!1,deleting:!1,resuming:!1}}),this.initTasksData(),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),this.setState({operationBtns:{pausing:!1,deleting:!1,resuming:!1}});case 13:case"end":return e.stop()}},e,this,[[0,10]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"loadMoreTasks",value:function(e){var t=this;this.setState({loadingMore:!0}),void 0===e&&(e=this.props.tasks.nextCursor),(0,B.getTasksOrHistoryForManagementAPI)(e,this.filterConditions.url,this.filterConditions.state).then(function(e){t.props.dispatch((0,_.refreshTasksSuccess)(e)),t.setState({loadingMore:!1})},function(e){t.props.dispatch((0,_.refreshTasksFail)(e)),t.setState({loadingMore:!1})})}},{key:"initTasksData",value:function(){var e=this;this.props.dispatch((0,_.resetTasks)()),this.setState({loadingTasksData:!0,selectedRowKeys:[],selectedRows:[]}),(0,B.getTasksOrHistoryForManagementAPI)(void 0,this.filterConditions.url,this.filterConditions.state).then(function(t){e.setState({loadingTasksData:!1}),e.props.dispatch((0,_.refreshTasksSuccess)(t))},function(t){e.setState({loadingTasksData:!1}),e.props.dispatch((0,_.refreshTasksFail)(t))})}},{key:"render",value:function(){var e=this,t=this.state,a=t.loadingTasksData,s=t.contentHeight,f=t.loadingMore,m=t.drawerVisiable,p=t.selectedTask,h=this.props.tasks,v=F.default.createElement(P.default,null),k=[(0,c.default)({title:"Target URL",dataIndex:"url",filteredValue:this.filterConditions.url},this.getColumnSearchProps("url")),(0,c.default)({title:(0,R.formatMessage)({id:"app.common.messages.state"}),dataIndex:"system.state",render:function(e){return F.default.createElement(N.default,{state:e})},filteredValue:this.filterConditions.state},this.getColumnCheckboxProps("state",[{label:(0,R.formatMessage)({id:"app.common.messages.stateDraft"}),value:"DRAFT"},{label:(0,R.formatMessage)({id:"app.common.messages.stateConfigured"}),value:"CONFIGURED"},{label:(0,R.formatMessage)({id:"app.common.messages.stateFinished"}),value:"FINISHED"},{label:(0,R.formatMessage)({id:"app.common.messages.stateRunning"}),value:"RUNNING"},{label:(0,R.formatMessage)({id:"app.common.messages.stateFailed"}),value:"FAILED"},{label:(0,R.formatMessage)({id:"app.common.messages.statePaused"}),value:"PAUSED"},{label:(0,R.formatMessage)({id:"app.common.messages.stateTimeout"}),value:"TIMEOUT"}])),{title:(0,R.formatMessage)({id:"app.common.messages.retailerState"}),dataIndex:"retailer.state",render:function(e){var t=e;return t===L.STATES.failed?t=L.STATES.lostConnection:t===L.STATES.active&&(t=L.STATES.connected),F.default.createElement(N.default,{state:t})}},{title:"Last Modified At",dataIndex:"system.modified",render:function(e){return(0,I.default)(e).format("YYYY/MM/DD HH:mm:ss")}}],E={selectedRowKeys:this.state.selectedRowKeys,onChange:function(t,a){e.setState({selectedRowKeys:t,selectedRows:a})}};if(!a)if(h.data&&h.data.length||x.default.keys(this.filterConditions).length){var S=h&&h.total||0;this.state.selectedRows&&this.state.selectedRows.length&&(S=this.state.selectedRows.length);var T=!1;(this.state.operationBtns.pausing||this.state.operationBtns.resuming||this.state.operationBtns.deleting)&&(T=!0),S&&!a||(T=!0);var y=F.default.createElement(u.default,null,F.default.createElement(u.default.Item,null,F.default.createElement(g.default,{type:"link",onClick:function(){e.onPauseAll()},disabled:T,loading:this.state.operationBtns.pausing},F.default.createElement(R.FormattedMessage,{id:"app.containers.Tasks.pauseAll",values:{taskNumber:S}}))),F.default.createElement(u.default.Item,null,F.default.createElement(g.default,{type:"link",onClick:function(){e.onResumeAll()},disabled:T,loading:this.state.operationBtns.resuming},F.default.createElement(R.FormattedMessage,{id:"app.containers.Tasks.resumeAll",values:{taskNumber:S}}))),F.default.createElement(u.default.Item,null,F.default.createElement(g.default,{type:"link",onClick:function(){e.onDeleteAll()},disabled:T,loading:this.state.operationBtns.deleting},F.default.createElement(R.FormattedMessage,{id:"app.containers.Tasks.deleteAll",values:{taskNumber:S}})))),w=F.default.createElement("div",{style:{display:"inline-block"}},F.default.createElement("div",{style:{display:"inline-block"}},F.default.createElement("span",null,F.default.createElement(R.FormattedMessage,{id:"app.containers.Tasks.showTasks",values:{tasksNumber:x.default.get(h,"data.length"),tasksTotal:h.total}}))),F.default.createElement(g.default,{type:"link",onClick:function(){return e.initTasksData()},disabled:a},F.default.createElement(D.default,{date:h.modified}),F.default.createElement(o.default,{type:"sync",style:{verticalAlign:"middle",marginLeft:"5px"},spin:a})));v=F.default.createElement("div",{className:"task-table-container"},F.default.createElement("div",null,F.default.createElement("div",{style:{paddingBottom:"15px"}},F.default.createElement(l.default,null,F.default.createElement(A.default,{minWidth:1444},F.default.createElement(i.default,{span:14},F.default.createElement(g.default,{onClick:function(){e.onPauseAll()},disabled:T,loading:this.state.operationBtns.pausing},F.default.createElement(R.FormattedMessage,{id:"app.containers.Tasks.pauseAll",values:{taskNumber:S}})),F.default.createElement(g.default,{onClick:function(){e.onResumeAll()},style:{marginLeft:"10px"},disabled:T,loading:this.state.operationBtns.resuming},F.default.createElement(R.FormattedMessage,{id:"app.containers.Tasks.resumeAll",values:{taskNumber:S}})),F.default.createElement(g.default,{onClick:function(){e.onDeleteAll()},style:{marginLeft:"10px"},disabled:T,loading:this.state.operationBtns.deleting},F.default.createElement(R.FormattedMessage,{id:"app.containers.Tasks.deleteAll",values:{taskNumber:S}}))),F.default.createElement(i.default,{span:10,style:{textAlign:"right"}},w)),F.default.createElement(A.default,{maxWidth:1444},F.default.createElement(i.default,{span:3},F.default.createElement(r.default,{overlay:y},F.default.createElement(g.default,null,F.default.createElement(o.default,{type:"menu"})))),F.default.createElement(i.default,{span:21,style:{textAlign:"right"}},w)))),F.default.createElement(n.default,{className:"",pagination:!1,bordered:!0,columns:k,rowSelection:E,dataSource:h.data,rowKey:function(e){return e.globalId},scroll:{y:s-310},onRow:function(t){return{onClick:function(){e.onShowDrawer(t)}}}}),f?Y:""))}else v=F.default.createElement(V,null,F.default.createElement(d.default,{description:F.default.createElement("span",null,F.default.createElement(R.FormattedHTMLMessage,{id:"app.containers.Tasks.emptyTasks"}))}));return F.default.createElement("div",{style:{padding:"20px"}},F.default.createElement(C.PageHeaderWrapper,null,v,F.default.createElement(O.default,{visiable:m,onCloseDrawer:function(){e.onCloseDrawer()},task:p})))}}],[{key:"onPreventShowDrawer",value:function(e){e.preventDefault(),e.stopPropagation()}}]),a}(F.default.Component);t.Tasks=W;var q=(0,H.connect)(function(e){var t=e.tasks;return{tasks:t}})(W);t.default=q},wsQp:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REFRESH_TASKS_FAIL=t.REFRESH_TASKS_SUCCESS=t.REFRESH_TASKS=t.RESET_TASKS=void 0;var s="tasks/resetTasks";t.RESET_TASKS=s;var n="tasks/refreshTasks";t.REFRESH_TASKS=n;var l="tasks/refreshTasksSuccess";t.REFRESH_TASKS_SUCCESS=l;var r="tasks/refreshTasksFail";t.REFRESH_TASKS_FAIL=r}}]);